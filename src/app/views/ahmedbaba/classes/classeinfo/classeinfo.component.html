<div *ngIf="loading" class="loading-container">
  <mat-spinner diameter="60"></mat-spinner>
  <p class="loading-text">Chargement des informations de la classe...</p>
</div>

<div *ngIf="!loading && classe" class="classe-detail-container">

  <!-- Bannière principale -->
  <div class="classe-banner">
    <div class="banner-overlay">
      <div class="classe-icon-large">
        <mat-icon>school</mat-icon>
      </div>
      <h1 class="classe-title">{{ classe.nom }}</h1>
      <p class="classe-subtitle">{{ classe.description }}</p>
      <div class="banner-badges">
        <span class="badge niveau">{{ classe.niveau }}</span>
        <span class="badge annee">{{ classe.anneeScolaire }}</span>
      </div>
    </div>
    
    <!-- Actions flottantes -->
    <div class="floating-actions">
      <button mat-fab color="primary" class="action-btn" (click)="updateClasse()" matTooltip="Modifier la classe">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-fab color="warn" class="action-btn" (click)="deleteClasse()" matTooltip="Supprimer la classe">
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </div>

  <!-- Grille d'informations principales -->
  <div class="info-grid">
    
    <!-- Informations générales -->
    <mat-card class="info-card">
      <mat-card-header class="card-header-modern">
        <mat-icon class="card-icon">info</mat-icon>
        <h2 class="card-title">Informations générales</h2>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content class="card-content">
        <div class="info-item">
          <mat-icon class="info-icon">badge</mat-icon>
          <div class="info-content">
            <span class="info-label">Identifiant</span>
            <span class="info-value">#{{ classe.id }}</span>
          </div>
        </div>
        <div class="info-item">
          <mat-icon class="info-icon">description</mat-icon>
          <div class="info-content">
            <span class="info-label">Description</span>
            <span class="info-value">{{ classe.description }}</span>
          </div>
        </div>
        <div class="info-item">
          <mat-icon class="info-icon">grade</mat-icon>
          <div class="info-content">
            <span class="info-label">Niveau</span>
            <span class="info-value badge-inline {{ classe.niveau?.toLowerCase() }}">{{ classe.niveau }}</span>
          </div>
        </div>
        <div class="info-item">
          <mat-icon class="info-icon">event</mat-icon>
          <div class="info-content">
            <span class="info-label">Année scolaire</span>
            <span class="info-value">{{ classe.anneeScolaire }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Effectif et capacité -->
    <mat-card class="info-card">
      <mat-card-header class="card-header-modern">
        <mat-icon class="card-icon">people</mat-icon>
        <h2 class="card-title">Effectif & Capacité</h2>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content class="card-content">
        <div class="info-item">
          <mat-icon class="info-icon">group</mat-icon>
          <div class="info-content">
            <span class="info-label">Effectif actuel</span>
            <span class="info-value">{{ classe.effectifActuel }} élèves</span>
          </div>
        </div>
        <div class="info-item">
          <mat-icon class="info-icon">meeting_room</mat-icon>
          <div class="info-content">
            <span class="info-label">Capacité maximale</span>
            <span class="info-value">{{ classe.capaciteMax }} élèves</span>
          </div>
        </div>
        <div class="capacity-progress">
          <div class="progress-info">
            <span>Taux d'occupation</span>
            <span class="occupation-rate">{{ getOccupationRate(classe) }}%</span>
          </div>
          <mat-progress-bar 
            class="progress-bar"
            [value]="getOccupationRate(classe)"
            [color]="getProgressColor(getOccupationRate(classe))">
          </mat-progress-bar>
          <div class="progress-stats">
            <span>{{ classe.effectifActuel }} / {{ classe.capaciteMax }}</span>
            <span>{{ classe.capaciteMax - classe.effectifActuel }} places restantes</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Localisation -->
    <mat-card class="info-card">
      <mat-card-header class="card-header-modern">
        <mat-icon class="card-icon">location_on</mat-icon>
        <h2 class="card-title">Localisation</h2>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content class="card-content">
        <div class="info-item">
          <mat-icon class="info-icon">meeting_room</mat-icon>
          <div class="info-content">
            <span class="info-label">Salle</span>
            <span class="info-value">{{ classe.salle }}</span>
          </div>
        </div>
        <div class="info-item">
          <mat-icon class="info-icon">business</mat-icon>
          <div class="info-content">
            <span class="info-label">Bâtiment</span>
            <span class="info-value">{{ classe.batiment }}</span>
          </div>
        </div>
        <div class="info-item">
          <mat-icon class="info-icon">stairs</mat-icon>
          <div class="info-content">
            <span class="info-label">Étage</span>
            <span class="info-value">
              {{ classe.etage === 0 ? 'Rez-de-chaussée' : 
                 classe.etage === 1 ? '1er étage' : 
                 classe.etage + 'ème étage' }}
            </span>
          </div>
        </div>
        <div class="location-summary">
          <mat-icon>place</mat-icon>
          <span>{{ classe.batiment }} - {{ classe.salle }} ({{ classe.etage === 0 ? 'RDC' : 'Étage ' + classe.etage }})</span>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Organisation pédagogique -->
    <mat-card class="info-card">
      <mat-card-header class="card-header-modern">
        <mat-icon class="card-icon">schedule</mat-icon>
        <h2 class="card-title">Organisation</h2>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content class="card-content">
        <div class="info-item">
          <mat-icon class="info-icon">access_time</mat-icon>
          <div class="info-content">
            <span class="info-label">Régime horaire</span>
            <span class="info-value">{{ getRegimeLabel(classe.regime) }}</span>
          </div>
        </div>
        <div class="info-item">
          <mat-icon class="info-icon">translate</mat-icon>
          <div class="info-content">
            <span class="info-label">Langue d'enseignement</span>
            <span class="info-value">{{ classe.langueEnseignement }}</span>
          </div>
        </div>
        <div class="regime-details">
          <mat-icon>info_outline</mat-icon>
          <span>
            {{ getRegimeDescription(classe.regime) }}
          </span>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Statut de la classe -->
    <mat-card class="info-card status-card">
      <mat-card-header class="card-header-modern">
        <mat-icon class="card-icon">flag</mat-icon>
        <h2 class="card-title">Statut</h2>
      </mat-card-header>
      <mat-divider></mat-divider>
      <mat-card-content class="card-content">
        <div class="status-indicator" [class.archived]="classe.archive">
          <mat-icon class="status-icon">
            {{ classe.archive ? 'archive' : 'check_circle' }}
          </mat-icon>
          <div class="status-content">
            <span class="status-text">
              {{ classe.archive ? 'Classe archivée' : 'Classe active' }}
            </span>
            <span class="status-subtext">
              {{ classe.archive ? 'Non disponible pour les nouvelles inscriptions' : 'Ouverte aux inscriptions' }}
            </span>
          </div>
        </div>
        <div class="status-actions" *ngIf="!classe.archive">
          <button mat-stroked-button color="primary" (click)="archiverClasse()">
            <mat-icon>archive</mat-icon>
            Archiver la classe
          </button>
        </div>
      </mat-card-content>
    </mat-card>

  </div>

</div>